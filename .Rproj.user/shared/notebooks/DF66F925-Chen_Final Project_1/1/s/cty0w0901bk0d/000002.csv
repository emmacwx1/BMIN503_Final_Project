"0","# Run FlowSOM on the UMAP axes"
"0","umap.matrix <- as.matrix(umap.data)"
"0",""
"0","# create flowFrame"
"0","UMAP.metadata <-"
"0","  data.frame(name = dimnames(umap.matrix)[[2]],"
"0","             desc = paste('UMAP', dimnames(umap.matrix)[[2]]))"
"0","UMAP.metadata$range <- apply(apply(umap.matrix, 2, range), 2, diff)"
"0","UMAP.metadata$minRange <- apply(umap.matrix, 2, min)"
"0","UMAP.metadata$maxRange <- apply(umap.matrix, 2, max)"
"0","umap.flowframe <- new(""flowFrame"","
"0","                      exprs = umap.matrix,"
"0","                      parameters = AnnotatedDataFrame(UMAP.metadata))"
"0",""
"0","# implement the FlowSOM on the data"
"0","fsom <-"
"0","  FlowSOM("
"0","    umap.flowframe,"
"0","    compensate = FALSE,"
"0","    transform = FALSE,"
"0","    toTransform = c(1:2),"
"0","    scale = TRUE,"
"0","    colsToUse = c(1:2),"
"0","    nClus = 20, #change this"
"0","    seed = overall_seed"
"0","  )"
"0","FlowSOM.clusters <-"
"0","  as.matrix(fsom[[2]][fsom[[1]]$map$mapping[, 1]])"
"0",""
"0","# plot FlowSOM clusters on UMAP axes"
"0","ggplot(UMAP.plot) + coord_fixed(ratio=graphical.ratio) + "
"0","  geom_point(aes(x=x, y=y, color=FlowSOM.clusters),cex = 1.5) + "
"0","  labs(x = ""UMAP 1"", y = ""UMAP 2"",title = ""FlowSOM Clustering on UMAP Axes"", "
"0","       color = ""FlowSOM Cluster"") + theme_bw() + "
"0","  guides(colour = guide_legend(override.aes = list(size=5)))+"
"0","  labs(caption = ""Data from Divij Mathew/Wherry Lab"")"
